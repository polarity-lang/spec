In this section we show how to typecheck constructors applied to arguments.
We first specify the rules for the system without implicit arguments, and then for the system with implicit arguments.

\subsection{Type Inference Without Implicit Arguments}

Let us first recapitulate how the rules work for constructors without implicit arguments.

\subsubsection*{Declarative Rules}

We start with the declarative rules for data type declarations.
\begin{prooftree}
    \AxiomC{$\vdash \telescope{\Psi}$}
    \AxiomC{$\forall i : \quad \vdash \telescope{\Xi_i} \quad \Xi_i \vdash \rho_i : \Psi$}
    \RightLabel{\textsc{Data}}
    \BinaryInfC{$\mathbf{data}\ \mathcal{T}\Psi\ \{\ldots, \mathcal{K}_i \Xi_i : \mathcal{T}\rho_i, \ldots \}$}
\end{prooftree}

In the following rule we presume the data definition from above to be in scope, so that we don't have to repeat it in all of the premisses.
The rule for typing constructors is as follows

\begin{prooftree}
    \AxiomC{$\Gamma \vdash \sigma : \Xi_i$}
    \RightLabel{\textsc{Ctor}}
    \UnaryInfC{$\Gamma \vdash \mathcal{K}_i\sigma : \mathcal{T}\rho_i[\sigma / \Xi_i]$}
\end{prooftree}

\subsubsection*{Bidirectional Rules}

The rule for data declarations is mostly unchanged, so we don't repeat it here.
But we now have two rules for constructors.
For notation, we use $\ldots \Rightarrow \ldots$ for inference and $\ldots \Leftarrow \ldots$ for checking.

\begin{prooftree}
    \AxiomC{$\Gamma \vdash \sigma \Leftarrow \Xi_i$}
    \RightLabel{\textsc{Ctor-Infer}}
    \UnaryInfC{$\Gamma \vdash \mathcal{K}_i\sigma \Rightarrow \mathcal{T}\rho_i[\sigma / \Xi_i]$}
\end{prooftree}

\begin{prooftree}
    \AxiomC{$\Gamma \vdash \sigma \Leftarrow \Xi_i$}
    \AxiomC{$\unify(\tau, \mathcal{T}\rho_i[\sigma / \Xi_i])$}
    \RightLabel{\textsc{Ctor-Check}}
    \BinaryInfC{$\Gamma \vdash \mathcal{K}_i\sigma \Leftarrow \tau$}
\end{prooftree}

\subsection{Type Inference With Implicit Arguments}

We first have to modify the rule for data types in the following way.

\begin{prooftree}
    \AxiomC{$\vdash \telescope{\Psi}$}
    \AxiomC{$\forall i : \quad \vdash \telescope{\Xi_i,\Xi'_i,} \quad \Xi_i,\Xi'_i \vdash \rho_i : \Psi$}
    \RightLabel{\textsc{Data}}
    \BinaryInfC{$\mathbf{data}\ \mathcal{T}\Psi\ \{\ldots, \mathcal{K}_i \{\Xi_i\}(\Xi'_i) : \mathcal{T}\rho_i, \ldots \}$}
\end{prooftree}

For the moment we don't allow implicit arguments for type constructors.
But every constructor comes with a list of implicit arguments and a list of explicit arguments.

\begin{prooftree}
    \AxiomC{$\sigma\ \mathrm{fresh}$}
    \AxiomC{$\Gamma \vdash (\sigma,\sigma') \Leftarrow \Xi_i, \Xi'_i$}
    \RightLabel{\textsc{Ctor-Infer}}
    \BinaryInfC{$\Gamma \vdash \mathcal{K}_i\{\_\}(\sigma') \Rightarrow \mathcal{T}\rho_i[\sigma,\sigma' / \Xi_i, \Xi'_i]$}
\end{prooftree}

\begin{prooftree}
    \AxiomC{$\sigma\ \mathrm{fresh}$}
    \AxiomC{$\Gamma \vdash (\sigma,\sigma') \Leftarrow \Xi_i, \Xi'_i$}
    \AxiomC{$\unify(\tau, \mathcal{T}\rho_i[\sigma,\sigma' / \Xi_i, \Xi'_i])$}
    \RightLabel{\textsc{Ctor-Check}}
    \TrinaryInfC{$\Gamma \vdash \mathcal{K}_i\{\_\}(\sigma') \Leftarrow \tau$}
\end{prooftree}

% \subsection{Checking rules}
% \label{subsec:typeinference:check}

% \begin{prooftree}
%     \AxiomC{$\normalize{t}{T\rho}$}
%     \AxiomC{$\mathbf{codata}\ T\Xi \{\} \in \Theta$}
%     \AxiomC{$\Gamma \vdash \rho \Leftarrow \Xi$}
%     \AxiomC{$\Gamma; T\rho \vdash o$}
%     \RightLabel{\textsc{Cocase}}
%     \QuaternaryInfC{$\Gamma \vdash \mathbf{cocase}\ \{ \overline{o} \} \Leftarrow t$}
% \end{prooftree}

% \begin{prooftree}
%     \AxiomC{$\mathbf{codata}\ T\Xi \{ (z: T\sigma).D\Xi : t \} \in \Theta$}
%     \AxiomC{$\unify(\rho,\sigma) = \psi$}
%     \AxiomC{$\Gamma\psi \vdash \ldots$}
%     \RightLabel{\textsc{Cocase-Ok}}
%     \TrinaryInfC{$\Gamma; T\rho \vdash D\Delta \mapsto e$}
% \end{prooftree}

% \begin{prooftree}
%     \AxiomC{$\mathbf{codata}\ T\Xi \{ (z: T\sigma).D\Xi : t \} \in \Theta$}
%     \AxiomC{$\unify(\rho,\sigma) = \text{fail}$}
%     \RightLabel{\textsc{Cocase-Absurd}}
%     \BinaryInfC{$\Gamma; T\rho \vdash D\Delta\ \mathbf{absurd}$}
% \end{prooftree}

% \subsection{Inference rules}
% \label{subsec:typeinference:infer}

% \begin{prooftree}
%     \AxiomC{$(x : t) \in \Gamma$}
%     \RightLabel{\textsc{Var}}
%     \UnaryInfC{$\Gamma \vdash x : t$}
% \end{prooftree}

% \begin{prooftree}
%     \AxiomC{}
%     \RightLabel{\textsc{Type}}
%     \UnaryInfC{$\Gamma \vdash \Type \Rightarrow \Type$}
% \end{prooftree}

% \begin{prooftree}
%     \AxiomC{$\mathbf{data}\ T\Delta\ \{\} \in \Theta$}
%     \AxiomC{$\Gamma \vdash \sigma \Leftarrow \Delta$}
%     \RightLabel{\textsc{TyCtor}$_1$}
%     \BinaryInfC{$\Gamma \vdash T\sigma \Rightarrow \Type$}
% \end{prooftree}

% \begin{prooftree}
%     \AxiomC{$\mathbf{codata}\ T\Delta\ \{\} \in \Theta$}
%     \AxiomC{$\Gamma \vdash \sigma \Leftarrow \Delta$}
%     \RightLabel{\textsc{TyCtor}$_2$}
%     \BinaryInfC{$\Gamma \vdash T\sigma \Rightarrow \Type$}
% \end{prooftree}

% \begin{prooftree}
%     \AxiomC{$\Gamma \vdash e \Leftarrow t$}
%     \RightLabel{\textsc{Annotation}}
%     \UnaryInfC{$\Gamma \vdash (e : t) \Rightarrow t$}
% \end{prooftree}

% \begin{prooftree}
%     \AxiomC{$\mathbf{data}\ T\Delta\ \{ K\Xi : T\rho \} \in \Theta$}
%     \AxiomC{$\Gamma \vdash \sigma \Leftarrow \Xi$}
%     \RightLabel{\textsc{Ctor}}
%     \BinaryInfC{$\Gamma \vdash K\sigma \Rightarrow T\rho[\sigma/\Xi]$}
% \end{prooftree}

% \begin{prooftree}
%     \AxiomC{$\mathbf{codata}\ T\Delta\ \{ (z : T\rho).D\Xi : t\} \in \Theta$}
%     \AxiomC{$\Gamma \vdash \sigma \Leftarrow \Xi$}
%     \AxiomC{$\Gamma \vdash e \Leftarrow T\rho[\sigma / \Xi]$}
%     \RightLabel{\textsc{Dtor}}
%     \TrinaryInfC{$\Gamma \vdash e.D\sigma \Rightarrow t[\sigma/\Xi][e/z]$}
% \end{prooftree}